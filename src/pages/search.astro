---
import Layout from "@layouts/Layout.astro";
import ItemPreview from "@components/ItemPreview.astro";
import algoliaSearch from "@modules/algoliaSearch";

const query = Astro.url.searchParams.get("q");
if (!query) return Astro.redirect("/");

const posts = await algoliaSearch(query);
if (!posts) return Astro.redirect("/404");
---

<Layout title={query}>
  {
    posts.map((post) => {
      if (!post.title) return;

      return <ItemPreview data={post} />;
    })
  }
</Layout>
