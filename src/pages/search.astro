---
import Layout from "@layouts/Layout.astro";
import ItemPreview from "@components/ItemPreview.astro";
import makeSearch from "@modules/makeSearch";

const query = Astro.url.searchParams.get("q");
const posts = await makeSearch(query);

// Get bookmarked IDs from cookie
const bookmarkCookie = Astro.cookies.get("bookmarks")?.value;
const bookmarkedIds = new Set(
  bookmarkCookie
    ? bookmarkCookie.split(",").map((id) => parseInt(id, 10)).filter((id) => !isNaN(id))
    : []
);
---

<Layout title={`${query} on HackerNews`}>
  {
    posts.map((post) => {
      if (!post.title) return;

      return <ItemPreview data={post} bookmarkedIds={bookmarkedIds} />;
    })
  }
</Layout>
