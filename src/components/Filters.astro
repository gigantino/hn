---
import StarIcon from "@components/icons/Star.astro";
import UpvoteIcon from "@components/icons/Upvote.astro";
import ClockIcon from "@components/icons/Clock.astro";

const filter = Astro.url.searchParams.get("filter");
const page = Astro.url.searchParams.get("page");

type Category = {
  label: string;
  icon: "star" | "upvote" | "clock";
  filter: string | null;
};

const categories: Category[] = [
  {
    label: "Trending",
    icon: "star",
    filter: null,
  },
  {
    label: "Most upvoted",
    icon: "upvote",
    filter: "top",
  },
  {
    label: "Newest",
    icon: "clock",
    filter: "new",
  },
];

// Create URL for filter, preserving current page
const linkFromCategory = (category: Category) => {
  const path = Astro.url.pathname;
  const params = new URLSearchParams();
  if (page && page !== "1") params.set("page", page);
  if (category.filter) params.set("filter", category.filter);
  const query = params.toString();
  return query ? `${path}?${query}` : path;
};

const isSelected = (category: Category) => {
  return filter == category.filter;
};
---

<div class="flex justify-center gap-3 text-sm sm:justify-start sm:text-base">
  {
    categories.map((category) =>
      isSelected(category) ? (
        <a class="hover:cursor-default hover:no-underline">
          <div class="flex flex-wrap justify-center gap-1 sm:justify-start">
            {category.icon === "star" && <StarIcon />}
            {category.icon === "upvote" && <UpvoteIcon />}
            {category.icon === "clock" && <ClockIcon />}
            <span class="font-bold">{category.label}</span>
          </div>
        </a>
      ) : (
        <a href={linkFromCategory(category)}>
          <div class="flex flex-wrap justify-center gap-1 sm:justify-start">
            {category.icon === "star" && <StarIcon />}
            {category.icon === "upvote" && <UpvoteIcon />}
            {category.icon === "clock" && <ClockIcon />}
            <span>{category.label}</span>
          </div>
        </a>
      )
    )
  }
</div>
