---
import xss from "xss";
import getRelativeTime from "@modules/getRelativeTime";
import extractDomainFromLink from "@modules/extractDomainFromLink";
import cleanText from "@modules/cleanText";
import type { HNItem } from "@/types/hn";
import UpvoteIcon from "@components/icons/Upvote.astro";
import CommentIcon from "@components/icons/Comment.astro";
import ExternalLinkIcon from "@components/icons/ExternalLink.astro";

interface Props {
  data: HNItem;
}
const { data } = Astro.props;
---

<div class="m-auto max-w-screen-md rounded-md border border-gray-300 bg-white dark:border-neutral-500/40 dark:bg-black">
  <div class="flex w-full flex-col gap-2 break-words p-3">
    <!-- Author, time and title -->
    <div class="flex flex-col gap-1">
      <div class="text-sm">
        {"Posted by "}
        <a href={`/@${data.by}`}>
          {data.by}
        </a>
        {` ${getRelativeTime(data.time)}`}
      </div>
      <a href={data.url ? data.url : `/item/${data.id}`} class="font-bold">
        {data.title}
      </a>
      <!-- External URL -->
      {
        data.url && (
          <span class="flex items-center gap-1 break-all text-sm">
            {extractDomainFromLink(data.url)}
            <ExternalLinkIcon />
          </span>
        )
      }
    </div>

    {data.text && (
      <>
        <hr class="border-gray-200 dark:border-neutral-500/40" />
        <div
          class="text-sm text-neutral-700 dark:text-neutral-300 [&>p]:my-2 [&>p:first-child]:mt-0 [&>p:last-child]:mb-0 [&_a]:text-blue-600 dark:[&_a]:text-blue-400 [&_a]:underline [&_code]:font-mono [&_code]:bg-neutral-200 dark:[&_code]:bg-neutral-700 [&_code]:text-[0.8em] [&_code]:px-1 [&_code]:rounded [&_pre]:bg-neutral-200 dark:[&_pre]:bg-neutral-700 [&_pre]:p-3 [&_pre]:rounded-md [&_pre]:overflow-x-auto [&_pre]:my-2 [&_pre_code]:bg-transparent [&_pre_code]:p-0 [&_.quote]:border-l-2 [&_.quote]:border-neutral-300 dark:[&_.quote]:border-neutral-600 [&_.quote]:pl-3 [&_.quote]:text-neutral-600 dark:[&_.quote]:text-neutral-400 [&_.quote]:italic"
          set:html={cleanText(xss(data.text))}
        />
      </>
    )}

    <hr class="border-gray-200 dark:border-neutral-500/40" />
    <!-- Upvotes and comments -->
    <div class="flex flex-wrap items-center gap-3 text-sm">
      <div class="flex gap-1">
        <UpvoteIcon />
        <span>{data.score ?? 0}</span>
      </div>
      <div class="flex gap-1">
        <CommentIcon />
        <span>{data.descendants ?? 0}</span>
      </div>
    </div>
  </div>
</div>
